@model PluralsightModel
@{
	ViewData["Title"] = "Pluralsight Manager";
}

<script>
	document.body.classList.add("pluralsight");
</script>

<h2><img class="ps-logo" src="https://s.pluralsight.com/logos/pluralsight/ps-logo-f-14-v1.png" alt="Pluralsight Logo">@ViewData["Title"]</h2>
<h4>@ViewData["Message"]</h4>
<hr />
<!--

	* Pluralsight API refferences:
		https://app.pluralsight.com/plans/api/license/docs?planId=upskilled
		License Management API token: 9c8cdda3-f9cb-4bf0-b243-029b590d2af5
		- Could be used for removing 'expired' students from Pluralsight

		https://app.pluralsight.com/plans/api/reports/docs
		Reports API token: 2f08d268-305f-467b-bf67-78f7af1ce36c
		- Gives complete data set of detailed user logs

Add some stats here:

	- Total users
	- Active users?


	For auto-deleting users, might need to manually pull the id's for students to be culled, and then put them into the site to handle from there.
		* Alternative: Download the full list of users using analytics API, match student id's and then check the last access from there

		To download the full list, send GET to: https://app.pluralsight.com/plan-analytics-api/reports/upskilled/user/all/download?range=all.
			* Must be logged in to Pluralsight first
-->
@{
	List<PluralsightUser> users = ViewData["UserList"] as List<PluralsightUser>;
	DateTime lastUpdate = DateTime.Now;
	if( ViewData["Update"] != null)
	{
		lastUpdate = (DateTime)ViewData["Update"];
	}
}
<div class="row">
	<div class="col-sm-3">
		<div class="row">
			<div class="col-sm-12">
				@{
					if (users == null)
					{
						<form asp-action="Pluralsight" asp-controller="Pluralsight" method="post">
							<button id="getUsers" type="submit" class="btn btn-default">Download Pluralsight User List</button>
						</form>
					}
					else
					{
						<form asp-action="Pluralsight" asp-controller="Pluralsight" method="post">
							<button id="getUsers" type="submit" class="btn btn-default">Update User List</button>
						</form>
						<span>Total User Count: @users.Count (/1500)<br />Last update: @lastUpdate.ToString()</span>
					}
				}
			</div>
		</div>
	</div>
	<div class="col-sm-9">
		<div class="row">
			<div class="col-sm-12">
				<div class="users-container">
					<table class="pluralsight-users">
						<tr>
							<th>Firstname</th>
							<th>Lastname</th>
							<th>Email</th>
							<th>User ID</th>
							<th>Start Date</th>
							<th>Team ID</th>
							<th>Notes</th>
						</tr>
						@{
							if (users != null)
							{
								@foreach (PluralsightUser u in users)
								{
									<tr>
										<td>@u.firstName</td>
										<td>@u.lastName</td>
										<td>@u.email</td>
										<td>@u.id</td>
										<td>@u.startDate</td>
										<td>@u.teamId</td>
										<td>@u.note</td>
									</tr>
								}
							}
						}
					</table>
				</div>
			</div>
		</div>
	</div>
</div>
